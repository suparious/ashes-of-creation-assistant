# Development-specific overrides

services:
  # Frontend in development mode with hot reloading
  frontend:
    build:
      target: dev
    volumes:
      - ../frontend:/app
      - /app/node_modules
    command: npm run dev
    environment:
      - NODE_ENV=development

  # Backend with auto-reload
  backend:
    volumes:
      - ../backend:/app
    environment:
      - DEBUG=true
      - LOG_LEVEL=debug
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  # Data pipeline in development mode
  data-pipeline:
    volumes:
      - ../data-pipeline:/app
    environment:
      - LOG_LEVEL=debug

  # Milvus with development settings
  milvus-standalone:
    ports:
      - "19530:19530"  # Expose API port for direct access in development
      - "9091:9091"    # Expose UI port
    environment:
      - ETCD_USE_EMBED=true
      - COMMON_SECURITY_ENABLED=true
      - COMMON_SECURITY_USERNAME=${MILVUS_USER:-milvus_user}
      - COMMON_SECURITY_PASSWORD=${MILVUS_PASSWORD:-milvus_password}

  # Redis with development settings
  redis:
    ports:
      - "6379:6379"    # Expose Redis port for direct access
    command: redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-ashes_default_pass} --loglevel debug

  # Development-friendly Nginx configuration
  nginx:
    volumes:
      - ../nginx/conf/myashes.dev.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - frontend
      - backend
    
  # Disable Certbot in development
  certbot:
    profiles: ["disabled"]
    
  # PostgreSQL with development settings
  postgres:
    ports:
      - "5432:5432"    # Expose PostgreSQL port for direct access
    environment:
      - POSTGRES_USER=${POSTGRES_USER:-postgres}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-postgres}
      - POSTGRES_DB=${POSTGRES_DB:-ashes_dev}
